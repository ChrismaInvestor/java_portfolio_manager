import{r as S,R as l,u as R,a as p,j as e,G as r,S as O,D as j,B as m,b as D,c as q,P as E,T as g,d as M,e as _,f as k,g as F,h as I,i as B,s as L,k as T}from"./index-DyCH4CyY.js";const y=S.createContext({});function z(t,n){switch(n.type){case"selectPortfolio":return{...t,currentPortfolio:n.payload};default:throw new Error}}const G=[{field:"securityCode",headerName:"证券代码",width:100},{field:"name",headerName:"证券名称",width:100},{field:"securityShare",headerName:"持股数",width:100},{field:"cost",headerName:"成本",width:100},{field:"value",headerName:"市值",width:100},{field:"profit",headerName:"盈亏",width:100}];function K(){const{state:t,dispatch:n}=l.useContext(y),[o,a]=l.useState(),[c]=R(),{isLoading:i,data:s}=p({queryKey:["getDynamics",o],queryFn:()=>fetch(m+"portfolio/dynamics?currentPortfolio="+o).then(h=>h.json()),enabled:!!o}),{data:u}=p({queryKey:["listPositions",o],queryFn:()=>fetch(m+"portfolio/portfolio?currentPortfolio="+o).then(h=>h.json()),enabled:!!o});return l.useEffect(()=>{n&&n({type:"selectPortfolio",payload:o})},[o]),i&&o?e.jsx("p",{children:"Loading..."}):e.jsxs(r,{container:!0,spacing:2,sx:{p:2},children:[e.jsx(r,{item:!0,xs:12,children:e.jsx(O,{placeholder:"选择投资组合",options:c,setValue:a,value:t==null?void 0:t.currentPortfolio})}),e.jsxs(r,{item:!0,xs:6,children:["当前现金:",s&&s.cash]}),e.jsxs(r,{item:!0,xs:6,children:["当前证券市值:",s&&s.securityMarketValue]}),e.jsxs(r,{item:!0,xs:6,children:["总市值:",s&&s.totalMarketValue]}),e.jsxs(r,{item:!0,xs:6,children:["收益率:",s&&s.profitMargin]}),e.jsx(r,{item:!0,xs:12,sx:{height:500},children:e.jsx(j,{columns:G,rows:u&&u.positions?u.positions:[]})})]})}async function V(t){const n=await t.arrayBuffer(),o=k(n),a=o.SheetNames[0];if(a){const c=o.Sheets[a];if(c){const i=F.sheet_to_json(c);for(let s=0;s<i.length;s++)i[s].id=s+1;return i}}return[]}const A=[{field:"code",headerName:"证券代码",width:200},{field:"name",headerName:"证券名称",width:200},{field:"weight",headerName:"权重",width:200}];function H(){const{acceptedFiles:t,getRootProps:n,getInputProps:o}=D(),{state:a}=l.useContext(y),[c,i]=l.useState([]),s=l.useMemo(()=>{const x=[];return t.forEach(d=>{x.push(e.jsxs("li",{children:[d.name," - ",d.size," bytes"]},d.name))}),x},[t]),[u,h]=l.useState([]);l.useEffect(()=>{t[0]&&(h([]),V(t[0]).then(d=>{console.log(d),h(d)}))},[t[0]]);const[v,N]=l.useState(""),b=q({mutationFn:()=>fetch(m+"position",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({positions:u,portfolio:a==null?void 0:a.currentPortfolio})}),onSuccess:async x=>{const d=await x.json();for(let f=0;f<d.length;f++)d[f].id=f+1;i(d)}}),C=()=>{i([])};return l.useMemo(()=>{u.length>0&&N("READY")},[u]),e.jsxs(r,{container:!0,spacing:2,sx:{p:2},children:[e.jsx(r,{item:!0,xs:4,children:e.jsx("div",{...n({className:"dropzone"}),children:e.jsxs(E,{children:[e.jsx("input",{...o()}),e.jsx(g,{align:"center",children:"点击此处上传"})]})})}),e.jsx(r,{item:!0,xs:4,children:e.jsx("aside",{children:e.jsx("ul",{children:s})})}),e.jsx(r,{item:!0,xs:4,children:e.jsx(M,{buttonStatus:v,submit:()=>{b.mutate()}})}),e.jsx(r,{item:!0,xs:12,sx:{height:800},children:e.jsx(j,{columns:A,rows:u})}),e.jsx(_,{open:c.length>0,orders:c,handleClose:C,portfolioName:a.currentPortfolio})]})}var P={},U=B;Object.defineProperty(P,"__esModule",{value:!0});var w=P.default=void 0,$=U(I()),J=e;w=P.default=(0,$.default)((0,J.jsx)("circle",{cx:"12",cy:"12",r:"8"}),"FiberManualRecord");const Q=L("progress")(()=>"background: blue,"),Y=[{field:"buyOrSell",headerName:"方向",width:80},{field:"securityCode",headerName:"证券代码",width:120},{field:"securityName",headerName:"证券名称",width:100},{field:"ratio",headerName:"完成率",width:220,type:"number",renderCell:t=>e.jsxs(r,{container:!0,spacing:1,children:[e.jsx(r,{item:!0,xs:10,children:e.jsx(Q,{value:String(t.value),max:"100"})}),e.jsx(r,{item:!0,xs:2,children:e.jsx(g,{children:t.value+"%"})})]})}];function W(t){return e.jsxs(T,{direction:"row",sx:{p:1},spacing:1,children:[e.jsx(w,{sx:{color:t.status==="connected"?"#4caf50":"#d9182e"}}),e.jsx(g,{children:t.status})]})}function X(t){const{orders:n}=t,[o]=l.useState("connected");return e.jsx(r,{container:!0,spacing:2,sx:{p:2},children:e.jsx(r,{item:!0,xs:12,children:e.jsx(j,{columns:Y,rows:n||[],sx:{maxHeight:600},slots:{footer:W},slotProps:{footer:{status:o}}})})})}const Z={currentPortfolio:null};function te(){const[t,n]=S.useReducer(z,Z),{isLoading:o,isError:a,data:c}=p({queryKey:["listOrders",t.currentPortfolio],queryFn:()=>fetch(m+"position/order?currentPortfolio="+t.currentPortfolio).then(i=>i.json()).then(i=>{for(let s=0;s<i.length;s++)i[s].id=s+1;return i}),refetchInterval:3e4});return o?e.jsx("div",{children:"Loading..."}):a?e.jsx("div",{children:"There is error in querying data"}):e.jsx(y.Provider,{value:{state:t,dispatch:n},children:e.jsxs(r,{container:!0,spacing:2,children:[e.jsx(r,{item:!0,xs:6,children:e.jsx(K,{})}),c.length===0&&e.jsx(r,{item:!0,xs:6,children:e.jsx(H,{})}),c.length>0&&e.jsx(r,{item:!0,xs:6,children:e.jsx(X,{orders:c})})]})})}export{te as default};
