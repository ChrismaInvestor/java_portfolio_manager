"use strict";(self.webpackChunkreact_portfolio_manager=self.webpackChunkreact_portfolio_manager||[]).push([[701],{7535:function(e,t,n){n.d(t,{v:function(){return o}});var r=n(4165),i=n(5861),s=n(6435),o=function(){var e=(0,i.Z)((0,r.Z)().mark((function e(){var t,n;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(s._+"portfolio",{method:"GET",headers:{"Content-Type":"application/json"}});case 2:if(200!==(t=e.sent).status){e.next=8;break}return e.next=6,t.json();case 6:return n=e.sent,e.abrupt("return",n);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},9701:function(e,t,n){n.r(t),n.d(t,{default:function(){return Q}});var r=n(9439),i=n(1889),s=n(7980),o=n(8096),a=n(4925),c=n(4415),l=n(3786),u=n(184);function d(e){var t=e.placeholder,n=e.options,r=e.value,i=e.setValue,s=e.name,d=e.disabled;return(0,u.jsxs)(o.Z,{sx:{width:"100%"},fullWidth:!0,children:[(0,u.jsx)(a.Z,{id:"select-label",children:t}),(0,u.jsx)(c.Z,{labelId:"select-label",id:"single-select",label:t,value:r,name:s,onChange:function(e){i&&i(e.target.value)},disabled:!!d&&d,children:n.map((function(e){return(0,u.jsx)(l.Z,{value:e,children:e},e)}))})]})}var h=n(2791),f=n(7535),x=n(4704),p=n(6435),m=n(1413),j=(0,h.createContext)({});function Z(e,t){if("selectPortfolio"===t.type)return(0,m.Z)((0,m.Z)({},e),{},{currentPortfolio:t.payload});throw new Error}var v=[{field:"securityCode",headerName:"\u8bc1\u5238\u4ee3\u7801",width:100},{field:"name",headerName:"\u8bc1\u5238\u540d\u79f0",width:100},{field:"securityShare",headerName:"\u6301\u80a1\u6570",width:100},{field:"cost",headerName:"\u6210\u672c",width:100},{field:"value",headerName:"\u5e02\u503c",width:100},{field:"profit",headerName:"\u76c8\u4e8f",width:100}];function P(){var e=h.useContext(j),t=e.state,n=e.dispatch,o=h.useState([]),a=(0,r.Z)(o,2),c=a[0],l=a[1],m=h.useState(),Z=(0,r.Z)(m,2),P=Z[0],y=Z[1];h.useEffect((function(){(0,f.v)().then((function(e){var t=null===e||void 0===e?void 0:e.map((function(e){return e.name}));t&&l(t)}))}),[]);var g=(0,x.a)({queryKey:["getDynamics",P],queryFn:function(){return fetch(p._+"portfolio/dynamics?currentPortfolio="+P).then((function(e){return e.json()}))},enabled:!!P}),b=g.isLoading,w=g.data,N=(0,x.a)({queryKey:["listPositions",P],queryFn:function(){return fetch(p._+"portfolio/portfolio?currentPortfolio="+P).then((function(e){return e.json()}))},enabled:!!P}).data;return h.useMemo((function(){n&&n({type:"selectPortfolio",payload:P})}),[P]),b&&P?(0,u.jsx)("p",{children:"Loading..."}):(0,u.jsxs)(i.ZP,{container:!0,spacing:2,sx:{p:2},children:[(0,u.jsx)(i.ZP,{item:!0,xs:12,children:(0,u.jsx)(d,{placeholder:"\u9009\u62e9\u6295\u8d44\u7ec4\u5408",options:c,setValue:y,value:null===t||void 0===t?void 0:t.currentPortfolio})}),(0,u.jsxs)(i.ZP,{item:!0,xs:6,children:["\u5f53\u524d\u73b0\u91d1:",w&&w.cash]}),(0,u.jsxs)(i.ZP,{item:!0,xs:6,children:["\u5f53\u524d\u8bc1\u5238\u5e02\u503c:",w&&w.securityMarketValue]}),(0,u.jsxs)(i.ZP,{item:!0,xs:6,children:["\u603b\u5e02\u503c:",w&&w.totalMarketValue]}),(0,u.jsxs)(i.ZP,{item:!0,xs:6,children:["\u6536\u76ca\u7387:",w&&w.profitMargin]}),(0,u.jsx)(i.ZP,{item:!0,xs:12,sx:{height:500},children:(0,u.jsx)(s._,{columns:v,rows:N&&N.positions?N.positions:[]})})]})}var y=n(4165),g=n(5861),b=n(5527),w=n(890),N=n(3954),C=n(4045),S=n(9709),_=n(6151),k=n(3329);function E(e){var t=e.buttonStatus,n=e.submit;switch(t){case"SUCCEED":return(0,u.jsx)(_.Z,{variant:"contained",color:"success",children:"\u6210\u529f"});case"ERROR":return(0,u.jsx)(_.Z,{variant:"outlined",color:"error",children:"\u9519\u8bef"});case"LOADING":return(0,u.jsx)(S.Z,{loading:!0,loadingPosition:"start",startIcon:(0,u.jsx)(k.Z,{}),variant:"outlined",children:"\u5904\u7406\u4e2d"});case"READY":return(0,u.jsx)(_.Z,{variant:"contained",color:"primary",onClick:n,children:"\u8bd5\u7b97"});default:return(0,u.jsx)(_.Z,{variant:"contained",color:"primary",disabled:!0,children:"\u8bd5\u7b97"})}}var O=n(3418),T=n(5574),D=n(5661),R=n(6314),q=n(9157),F=n(1652),I=n(2246),M=n(4750),A=[{field:"buyOrSell",headerName:"\u65b9\u5411",width:80},{field:"securityCode",headerName:"\u8bc1\u5238\u4ee3\u7801",width:120},{field:"securityName",headerName:"\u8bc1\u5238\u540d\u79f0",width:100},{field:"share",headerName:"\u9884\u4f30\u4efd\u6570",width:100,type:"number"},{field:"value",headerName:"\u9884\u4f30\u5e02\u503c",width:100,type:"number"}];function L(e){var t=e.open,n=e.data,o=e.handleClose,a=h.useContext(j).state,c=h.useState(null),l=(0,r.Z)(c,2),d=l[0],f=l[1],x=h.useState(null),m=(0,r.Z)(x,2),Z=m[0],v=m[1],P=(0,O.D)({mutationFn:function(){return fetch(p._+"position/order",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({orders:n,portfolio:null===a||void 0===a?void 0:a.currentPortfolio,startTime:d,endTime:Z})}).then((function(e){return e.json()}))}});return(0,u.jsx)(F._,{dateAdapter:M.y,children:(0,u.jsxs)(T.Z,{open:t,onClose:o,children:[(0,u.jsx)(D.Z,{children:(0,u.jsx)(R.Z,{direction:"row",spacing:2,children:(0,u.jsxs)(i.ZP,{container:!0,spacing:2,children:[(0,u.jsx)(i.ZP,{item:!0,xs:2,children:(0,u.jsx)(w.Z,{children:"\u8bd5\u7b97"})}),(0,u.jsx)(i.ZP,{item:!0,xs:5,children:(0,u.jsx)(I.x,{label:"\u5f00\u59cb\u65f6\u95f4",value:d,onChange:function(e){return f(e)},disablePast:!0})}),(0,u.jsx)(i.ZP,{item:!0,xs:5,children:(0,u.jsx)(I.x,{label:"\u7ed3\u675f\u65f6\u95f4",value:Z,onChange:function(e){return v(e)},disablePast:!0})}),(0,u.jsx)(i.ZP,{item:!0,xs:3,children:(0,u.jsx)(_.Z,{fullWidth:!0,variant:"contained",onClick:function(){P.mutate()},children:"\u63d0\u4ea4"})})]})})}),(0,u.jsx)(q.Z,{children:(0,u.jsx)(s._,{columns:A,rows:n})})]})})}function V(){return(V=(0,g.Z)((0,y.Z)().mark((function e(t){var n,r,i,s,o,a;return(0,y.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.arrayBuffer();case 2:if(n=e.sent,r=C.ij(n),!(i=r.SheetNames[0])){e.next=11;break}if(!(s=r.Sheets[i])){e.next=11;break}for(o=C.P6.sheet_to_json(s),a=0;a<o.length;a++)o[a].id=a+1;return e.abrupt("return",o);case 11:return e.abrupt("return",[]);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var K=[{field:"code",headerName:"\u8bc1\u5238\u4ee3\u7801",width:200},{field:"name",headerName:"\u8bc1\u5238\u540d\u79f0",width:200}];function z(){var e=(0,N.uI)(),t=e.acceptedFiles,n=e.getRootProps,o=e.getInputProps,a=h.useContext(j).state,c=h.useState([]),l=(0,r.Z)(c,2),d=l[0],f=l[1],x=h.useMemo((function(){var e=[];return t.forEach((function(t){e.push((0,u.jsxs)("li",{children:[t.name," - ",t.size," bytes"]},t.name))})),e}),[t]),Z=h.useState([]),v=(0,r.Z)(Z,2),P=v[0],y=v[1];h.useEffect((function(){if(t[0]){y([]);var e=function(e){return V.apply(this,arguments)}(t[0]);e.then((function(e){console.log(e),y(e)}))}}),[t[0]]);var g=h.useState(""),C=(0,r.Z)(g,2),S=C[0],_=C[1],k=(0,O.D)({mutationFn:function(){return fetch(p._+"position",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({positions:P,portfolio:null===a||void 0===a?void 0:a.currentPortfolio})}).then((function(e){return e.json()})).then((function(e){for(var t=0;t<e.length;t++)e[t].id=t+1;f(e)}))}});return h.useMemo((function(){P.length>0&&_("READY")}),[P]),(0,u.jsxs)(i.ZP,{container:!0,spacing:2,sx:{p:2},children:[(0,u.jsx)(i.ZP,{item:!0,xs:4,children:(0,u.jsx)("div",(0,m.Z)((0,m.Z)({},n({className:"dropzone"})),{},{children:(0,u.jsxs)(b.Z,{children:[(0,u.jsx)("input",(0,m.Z)({},o())),(0,u.jsx)(w.Z,{align:"center",children:"\u70b9\u51fb\u6b64\u5904\u4e0a\u4f20"})]})}))}),(0,u.jsx)(i.ZP,{item:!0,xs:4,children:(0,u.jsx)("aside",{children:(0,u.jsx)("ul",{children:x})})}),(0,u.jsx)(i.ZP,{item:!0,xs:4,children:(0,u.jsx)(E,{buttonStatus:S,submit:function(){k.mutate()}})}),(0,u.jsx)(i.ZP,{item:!0,xs:12,sx:{height:800},children:(0,u.jsx)(s._,{columns:K,rows:P})}),(0,u.jsx)(L,{open:d.length>0,data:d,handleClose:function(){f([])}})]})}var G=n(6934),J=n(7267),W=(0,G.ZP)("progress")((function(){return"background: blue,"})),Y=[{field:"buyOrSell",headerName:"\u65b9\u5411",width:80},{field:"securityCode",headerName:"\u8bc1\u5238\u4ee3\u7801",width:120},{field:"securityName",headerName:"\u8bc1\u5238\u540d\u79f0",width:100},{field:"ratio",headerName:"\u5b8c\u6210\u7387",width:220,type:"number",renderCell:function(e){return(0,u.jsxs)(i.ZP,{container:!0,spacing:1,children:[(0,u.jsx)(i.ZP,{item:!0,xs:10,children:(0,u.jsx)(W,{value:String(e.value),max:"100"})}),(0,u.jsx)(i.ZP,{item:!0,xs:2,children:(0,u.jsx)(w.Z,{children:e.value+"%"})})]})}}];function B(e){return(0,u.jsxs)(R.Z,{direction:"row",sx:{p:1},spacing:1,children:[(0,u.jsx)(J.Z,{sx:{color:"connected"===e.status?"#4caf50":"#d9182e"}}),(0,u.jsx)(w.Z,{children:e.status})]})}function H(e){var t=e.orders,n=h.useState("connected"),o=(0,r.Z)(n,2),a=o[0];o[1];return(0,u.jsx)(i.ZP,{container:!0,spacing:2,sx:{p:2},children:(0,u.jsx)(i.ZP,{item:!0,xs:12,children:(0,u.jsx)(s._,{columns:Y,rows:t||[],sx:{maxHeight:600},slots:{footer:B},slotProps:{footer:{status:a}}})})})}var U={currentPortfolio:null};function Q(){var e=(0,h.useReducer)(Z,U),t=(0,r.Z)(e,2),n=t[0],s=t[1],o=(0,x.a)({queryKey:["listOrders",n.currentPortfolio],queryFn:function(){return fetch(p._+"position/order?currentPortfolio="+n.currentPortfolio).then((function(e){return e.json()})).then((function(e){for(var t=0;t<e.length;t++)e[t].id=t+1;return e}))},refetchInterval:3e4}),a=(o.isLoading,o.data);return(0,u.jsx)(j.Provider,{value:{state:n,dispatch:s},children:(0,u.jsxs)(i.ZP,{container:!0,spacing:2,children:[(0,u.jsx)(i.ZP,{item:!0,xs:6,children:(0,u.jsx)(P,{})}),a&&0===a.length&&(0,u.jsx)(i.ZP,{item:!0,xs:6,children:(0,u.jsx)(z,{})}),a&&a.length>0&&(0,u.jsx)(i.ZP,{item:!0,xs:6,children:(0,u.jsx)(H,{orders:a})})]})})}}}]);
//# sourceMappingURL=701.4206025b.chunk.js.map