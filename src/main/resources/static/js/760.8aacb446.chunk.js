"use strict";(self.webpackChunkreact_portfolio_manager=self.webpackChunkreact_portfolio_manager||[]).push([[760],{9760:function(e,t,n){n.r(t),n.d(t,{default:function(){return G}});var r=n(9439),i=n(1889),s=n(7980),o=n(8186),a=n(2791),c=n(7535),l=n(4704),u=n(6435),d=n(1413),h=(0,a.createContext)({});function f(e,t){if("selectPortfolio"===t.type)return(0,d.Z)((0,d.Z)({},e),{},{currentPortfolio:t.payload});throw new Error}var x=n(184),m=[{field:"securityCode",headerName:"\u8bc1\u5238\u4ee3\u7801",width:100},{field:"name",headerName:"\u8bc1\u5238\u540d\u79f0",width:100},{field:"securityShare",headerName:"\u6301\u80a1\u6570",width:100},{field:"cost",headerName:"\u6210\u672c",width:100},{field:"value",headerName:"\u5e02\u503c",width:100},{field:"profit",headerName:"\u76c8\u4e8f",width:100}];function j(){var e=a.useContext(h),t=e.state,n=e.dispatch,d=a.useState([]),f=(0,r.Z)(d,2),j=f[0],p=f[1],Z=a.useState(),P=(0,r.Z)(Z,2),v=P[0],y=P[1];a.useEffect((function(){(0,c.v)().then((function(e){var t=null===e||void 0===e?void 0:e.map((function(e){return e.name}));t&&p(t)}))}),[]);var g=(0,l.a)({queryKey:["getDynamics",v],queryFn:function(){return fetch(u._+"portfolio/dynamics?currentPortfolio="+v).then((function(e){return e.json()}))},enabled:!!v}),w=g.isLoading,b=g.data,N=(0,l.a)({queryKey:["listPositions",v],queryFn:function(){return fetch(u._+"portfolio/portfolio?currentPortfolio="+v).then((function(e){return e.json()}))},enabled:!!v}).data;return a.useMemo((function(){n&&n({type:"selectPortfolio",payload:v})}),[v]),w&&v?(0,x.jsx)("p",{children:"Loading..."}):(0,x.jsxs)(i.ZP,{container:!0,spacing:2,sx:{p:2},children:[(0,x.jsx)(i.ZP,{item:!0,xs:12,children:(0,x.jsx)(o.Z,{placeholder:"\u9009\u62e9\u6295\u8d44\u7ec4\u5408",options:j,setValue:y,value:null===t||void 0===t?void 0:t.currentPortfolio})}),(0,x.jsxs)(i.ZP,{item:!0,xs:6,children:["\u5f53\u524d\u73b0\u91d1:",b&&b.cash]}),(0,x.jsxs)(i.ZP,{item:!0,xs:6,children:["\u5f53\u524d\u8bc1\u5238\u5e02\u503c:",b&&b.securityMarketValue]}),(0,x.jsxs)(i.ZP,{item:!0,xs:6,children:["\u603b\u5e02\u503c:",b&&b.totalMarketValue]}),(0,x.jsxs)(i.ZP,{item:!0,xs:6,children:["\u6536\u76ca\u7387:",b&&b.profitMargin]}),(0,x.jsx)(i.ZP,{item:!0,xs:12,sx:{height:500},children:(0,x.jsx)(s._,{columns:m,rows:N&&N.positions?N.positions:[]})})]})}var p=n(4165),Z=n(5861),P=n(5527),v=n(890),y=n(3954),g=n(4045),w=n(9709),b=n(6151),N=n(3329);function C(e){var t=e.buttonStatus,n=e.submit;switch(t){case"SUCCEED":return(0,x.jsx)(b.Z,{variant:"contained",color:"success",children:"\u6210\u529f"});case"ERROR":return(0,x.jsx)(b.Z,{variant:"outlined",color:"error",children:"\u9519\u8bef"});case"LOADING":return(0,x.jsx)(w.Z,{loading:!0,loadingPosition:"start",startIcon:(0,x.jsx)(N.Z,{}),variant:"outlined",children:"\u5904\u7406\u4e2d"});case"READY":return(0,x.jsx)(b.Z,{variant:"contained",color:"primary",onClick:n,children:"\u8bd5\u7b97"});default:return(0,x.jsx)(b.Z,{variant:"contained",color:"primary",disabled:!0,children:"\u8bd5\u7b97"})}}var S=n(3418),_=n(5574),k=n(5661),E=n(6314),O=n(9157),D=n(1652),R=n(2246),q=n(4750),F=[{field:"buyOrSell",headerName:"\u65b9\u5411",width:80},{field:"securityCode",headerName:"\u8bc1\u5238\u4ee3\u7801",width:120},{field:"securityName",headerName:"\u8bc1\u5238\u540d\u79f0",width:100},{field:"share",headerName:"\u9884\u4f30\u4efd\u6570",width:100,type:"number"},{field:"value",headerName:"\u9884\u4f30\u5e02\u503c",width:100,type:"number"}];function M(e){var t=e.open,n=e.data,o=e.handleClose,c=a.useContext(h).state,l=a.useState(null),d=(0,r.Z)(l,2),f=d[0],m=d[1],j=a.useState(null),p=(0,r.Z)(j,2),Z=p[0],P=p[1],y=(0,S.D)({mutationFn:function(){return fetch(u._+"position/order",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({orders:n,portfolio:null===c||void 0===c?void 0:c.currentPortfolio,startTime:f,endTime:Z})}).then((function(e){return e.json()}))}});return(0,x.jsx)(D._,{dateAdapter:q.y,children:(0,x.jsxs)(_.Z,{open:t,onClose:o,children:[(0,x.jsx)(k.Z,{children:(0,x.jsx)(E.Z,{direction:"row",spacing:2,children:(0,x.jsxs)(i.ZP,{container:!0,spacing:2,children:[(0,x.jsx)(i.ZP,{item:!0,xs:2,children:(0,x.jsx)(v.Z,{children:"\u8bd5\u7b97"})}),(0,x.jsx)(i.ZP,{item:!0,xs:5,children:(0,x.jsx)(R.x,{label:"\u5f00\u59cb\u65f6\u95f4",value:f,onChange:function(e){return m(e)},disablePast:!0})}),(0,x.jsx)(i.ZP,{item:!0,xs:5,children:(0,x.jsx)(R.x,{label:"\u7ed3\u675f\u65f6\u95f4",value:Z,onChange:function(e){return P(e)},disablePast:!0})}),(0,x.jsx)(i.ZP,{item:!0,xs:3,children:(0,x.jsx)(b.Z,{fullWidth:!0,variant:"contained",onClick:function(){y.mutate()},children:"\u63d0\u4ea4"})})]})})}),(0,x.jsx)(O.Z,{children:(0,x.jsx)(s._,{columns:F,rows:n})})]})})}function T(){return(T=(0,Z.Z)((0,p.Z)().mark((function e(t){var n,r,i,s,o,a;return(0,p.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.arrayBuffer();case 2:if(n=e.sent,r=g.ij(n),!(i=r.SheetNames[0])){e.next=11;break}if(!(s=r.Sheets[i])){e.next=11;break}for(o=g.P6.sheet_to_json(s),a=0;a<o.length;a++)o[a].id=a+1;return e.abrupt("return",o);case 11:return e.abrupt("return",[]);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var I=[{field:"code",headerName:"\u8bc1\u5238\u4ee3\u7801",width:200},{field:"name",headerName:"\u8bc1\u5238\u540d\u79f0",width:200}];function A(){var e=(0,y.uI)(),t=e.acceptedFiles,n=e.getRootProps,o=e.getInputProps,c=a.useContext(h).state,l=a.useState([]),f=(0,r.Z)(l,2),m=f[0],j=f[1],p=a.useMemo((function(){var e=[];return t.forEach((function(t){e.push((0,x.jsxs)("li",{children:[t.name," - ",t.size," bytes"]},t.name))})),e}),[t]),Z=a.useState([]),g=(0,r.Z)(Z,2),w=g[0],b=g[1];a.useEffect((function(){if(t[0]){b([]);var e=function(e){return T.apply(this,arguments)}(t[0]);e.then((function(e){console.log(e),b(e)}))}}),[t[0]]);var N=a.useState(""),_=(0,r.Z)(N,2),k=_[0],E=_[1],O=(0,S.D)({mutationFn:function(){return fetch(u._+"position",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({positions:w,portfolio:null===c||void 0===c?void 0:c.currentPortfolio})}).then((function(e){return e.json()})).then((function(e){for(var t=0;t<e.length;t++)e[t].id=t+1;j(e)}))}});return a.useMemo((function(){w.length>0&&E("READY")}),[w]),(0,x.jsxs)(i.ZP,{container:!0,spacing:2,sx:{p:2},children:[(0,x.jsx)(i.ZP,{item:!0,xs:4,children:(0,x.jsx)("div",(0,d.Z)((0,d.Z)({},n({className:"dropzone"})),{},{children:(0,x.jsxs)(P.Z,{children:[(0,x.jsx)("input",(0,d.Z)({},o())),(0,x.jsx)(v.Z,{align:"center",children:"\u70b9\u51fb\u6b64\u5904\u4e0a\u4f20"})]})}))}),(0,x.jsx)(i.ZP,{item:!0,xs:4,children:(0,x.jsx)("aside",{children:(0,x.jsx)("ul",{children:p})})}),(0,x.jsx)(i.ZP,{item:!0,xs:4,children:(0,x.jsx)(C,{buttonStatus:k,submit:function(){O.mutate()}})}),(0,x.jsx)(i.ZP,{item:!0,xs:12,sx:{height:800},children:(0,x.jsx)(s._,{columns:I,rows:w})}),(0,x.jsx)(M,{open:m.length>0,data:m,handleClose:function(){j([])}})]})}var L=n(6934),K=n(7267),V=(0,L.ZP)("progress")((function(){return"background: blue,"})),z=[{field:"buyOrSell",headerName:"\u65b9\u5411",width:80},{field:"securityCode",headerName:"\u8bc1\u5238\u4ee3\u7801",width:120},{field:"securityName",headerName:"\u8bc1\u5238\u540d\u79f0",width:100},{field:"ratio",headerName:"\u5b8c\u6210\u7387",width:220,type:"number",renderCell:function(e){return(0,x.jsxs)(i.ZP,{container:!0,spacing:1,children:[(0,x.jsx)(i.ZP,{item:!0,xs:10,children:(0,x.jsx)(V,{value:String(e.value),max:"100"})}),(0,x.jsx)(i.ZP,{item:!0,xs:2,children:(0,x.jsx)(v.Z,{children:e.value+"%"})})]})}}];function J(e){return(0,x.jsxs)(E.Z,{direction:"row",sx:{p:1},spacing:1,children:[(0,x.jsx)(K.Z,{sx:{color:"connected"===e.status?"#4caf50":"#d9182e"}}),(0,x.jsx)(v.Z,{children:e.status})]})}function Y(e){var t=e.orders,n=a.useState("connected"),o=(0,r.Z)(n,2),c=o[0];o[1];return(0,x.jsx)(i.ZP,{container:!0,spacing:2,sx:{p:2},children:(0,x.jsx)(i.ZP,{item:!0,xs:12,children:(0,x.jsx)(s._,{columns:z,rows:t||[],sx:{maxHeight:600},slots:{footer:J},slotProps:{footer:{status:c}}})})})}var B={currentPortfolio:null};function G(){var e=(0,a.useReducer)(f,B),t=(0,r.Z)(e,2),n=t[0],s=t[1],o=(0,l.a)({queryKey:["listOrders",n.currentPortfolio],queryFn:function(){return fetch(u._+"position/order?currentPortfolio="+n.currentPortfolio).then((function(e){return e.json()})).then((function(e){for(var t=0;t<e.length;t++)e[t].id=t+1;return e}))},refetchInterval:3e4}),c=(o.isLoading,o.data);return(0,x.jsx)(h.Provider,{value:{state:n,dispatch:s},children:(0,x.jsxs)(i.ZP,{container:!0,spacing:2,children:[(0,x.jsx)(i.ZP,{item:!0,xs:6,children:(0,x.jsx)(j,{})}),c&&0===c.length&&(0,x.jsx)(i.ZP,{item:!0,xs:6,children:(0,x.jsx)(A,{})}),c&&c.length>0&&(0,x.jsx)(i.ZP,{item:!0,xs:6,children:(0,x.jsx)(Y,{orders:c})})]})})}}}]);
//# sourceMappingURL=760.8aacb446.chunk.js.map