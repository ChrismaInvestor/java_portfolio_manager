"use strict";(self.webpackChunkreact_portfolio_manager=self.webpackChunkreact_portfolio_manager||[]).push([[613],{3613:function(e,r,t){t.r(r),t.d(r,{default:function(){return K}});var n=t(9439),i=t(1889),s=t(7980),o=t(8186),a=t(2791),c=t(4704),u=t(6435),l=t(1413),d=(0,a.createContext)({});function h(e,r){if("selectPortfolio"===r.type)return(0,l.Z)((0,l.Z)({},e),{},{currentPortfolio:r.payload});throw new Error}var f=t(8684),x=t(184),p=[{field:"securityCode",headerName:"\u8bc1\u5238\u4ee3\u7801",width:100},{field:"name",headerName:"\u8bc1\u5238\u540d\u79f0",width:100},{field:"securityShare",headerName:"\u6301\u80a1\u6570",width:100},{field:"cost",headerName:"\u6210\u672c",width:100},{field:"value",headerName:"\u5e02\u503c",width:100},{field:"profit",headerName:"\u76c8\u4e8f",width:100}];function j(){var e=a.useContext(d),r=e.state,t=e.dispatch,l=a.useState(),h=(0,n.Z)(l,2),j=h[0],m=h[1],Z=(0,f.Z)(),P=(0,n.Z)(Z,1)[0],v=(0,c.a)({queryKey:["getDynamics",j],queryFn:function(){return fetch(u._+"portfolio/dynamics?currentPortfolio="+j).then((function(e){return e.json()}))},enabled:!!j}),g=v.isLoading,y=v.data,w=(0,c.a)({queryKey:["listPositions",j],queryFn:function(){return fetch(u._+"portfolio/portfolio?currentPortfolio="+j).then((function(e){return e.json()}))},enabled:!!j}).data;return a.useEffect((function(){t&&t({type:"selectPortfolio",payload:j})}),[j]),g&&j?(0,x.jsx)("p",{children:"Loading..."}):(0,x.jsxs)(i.ZP,{container:!0,spacing:2,sx:{p:2},children:[(0,x.jsx)(i.ZP,{item:!0,xs:12,children:(0,x.jsx)(o.Z,{placeholder:"\u9009\u62e9\u6295\u8d44\u7ec4\u5408",options:P,setValue:m,value:null===r||void 0===r?void 0:r.currentPortfolio})}),(0,x.jsxs)(i.ZP,{item:!0,xs:6,children:["\u5f53\u524d\u73b0\u91d1:",y&&y.cash]}),(0,x.jsxs)(i.ZP,{item:!0,xs:6,children:["\u5f53\u524d\u8bc1\u5238\u5e02\u503c:",y&&y.securityMarketValue]}),(0,x.jsxs)(i.ZP,{item:!0,xs:6,children:["\u603b\u5e02\u503c:",y&&y.totalMarketValue]}),(0,x.jsxs)(i.ZP,{item:!0,xs:6,children:["\u6536\u76ca\u7387:",y&&y.profitMargin]}),(0,x.jsx)(i.ZP,{item:!0,xs:12,sx:{height:500},children:(0,x.jsx)(s._,{columns:p,rows:w&&w.positions?w.positions:[]})})]})}var m=t(4165),Z=t(5861),P=t(5527),v=t(890),g=t(3954),y=t(4045),w=t(9709),b=t(6151),N=t(3329);function S(e){var r=e.buttonStatus,t=e.submit;switch(r){case"SUCCEED":return(0,x.jsx)(b.Z,{variant:"contained",color:"success",children:"\u6210\u529f"});case"ERROR":return(0,x.jsx)(b.Z,{variant:"outlined",color:"error",children:"\u9519\u8bef"});case"LOADING":return(0,x.jsx)(w.Z,{loading:!0,loadingPosition:"start",startIcon:(0,x.jsx)(N.Z,{}),variant:"outlined",children:"\u5904\u7406\u4e2d"});case"READY":return(0,x.jsx)(b.Z,{variant:"contained",color:"primary",onClick:t,children:"\u8bd5\u7b97"});default:return(0,x.jsx)(b.Z,{variant:"contained",color:"primary",disabled:!0,children:"\u8bd5\u7b97"})}}var C=t(3418),_=t(4367);function k(){return(k=(0,Z.Z)((0,m.Z)().mark((function e(r){var t,n,i,s,o,a;return(0,m.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.arrayBuffer();case 2:if(t=e.sent,n=y.ij(t),!(i=n.SheetNames[0])){e.next=11;break}if(!(s=n.Sheets[i])){e.next=11;break}for(o=y.P6.sheet_to_json(s),a=0;a<o.length;a++)o[a].id=a+1;return e.abrupt("return",o);case 11:return e.abrupt("return",[]);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var E=[{field:"code",headerName:"\u8bc1\u5238\u4ee3\u7801",width:200},{field:"name",headerName:"\u8bc1\u5238\u540d\u79f0",width:200}];function q(){var e=(0,g.uI)(),r=e.acceptedFiles,t=e.getRootProps,o=e.getInputProps,c=a.useContext(d).state,h=a.useState([]),f=(0,n.Z)(h,2),p=f[0],j=f[1],y=a.useMemo((function(){var e=[];return r.forEach((function(r){e.push((0,x.jsxs)("li",{children:[r.name," - ",r.size," bytes"]},r.name))})),e}),[r]),w=a.useState([]),b=(0,n.Z)(w,2),N=b[0],q=b[1];a.useEffect((function(){if(r[0]){q([]);var e=function(e){return k.apply(this,arguments)}(r[0]);e.then((function(e){console.log(e),q(e)}))}}),[r[0]]);var R=a.useState(""),D=(0,n.Z)(R,2),O=D[0],F=D[1],I=(0,C.D)({mutationFn:function(){return fetch(u._+"position",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({positions:N,portfolio:null===c||void 0===c?void 0:c.currentPortfolio})})},onSuccess:function(){var e=(0,Z.Z)((0,m.Z)().mark((function e(r){var t,n;return(0,m.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.json();case 2:for(t=e.sent,n=0;n<t.length;n++)t[n].id=n+1;j(t);case 5:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}()});return a.useMemo((function(){N.length>0&&F("READY")}),[N]),(0,x.jsxs)(i.ZP,{container:!0,spacing:2,sx:{p:2},children:[(0,x.jsx)(i.ZP,{item:!0,xs:4,children:(0,x.jsx)("div",(0,l.Z)((0,l.Z)({},t({className:"dropzone"})),{},{children:(0,x.jsxs)(P.Z,{children:[(0,x.jsx)("input",(0,l.Z)({},o())),(0,x.jsx)(v.Z,{align:"center",children:"\u70b9\u51fb\u6b64\u5904\u4e0a\u4f20"})]})}))}),(0,x.jsx)(i.ZP,{item:!0,xs:4,children:(0,x.jsx)("aside",{children:(0,x.jsx)("ul",{children:y})})}),(0,x.jsx)(i.ZP,{item:!0,xs:4,children:(0,x.jsx)(S,{buttonStatus:O,submit:function(){I.mutate()}})}),(0,x.jsx)(i.ZP,{item:!0,xs:12,sx:{height:800},children:(0,x.jsx)(s._,{columns:E,rows:N})}),(0,x.jsx)(_.Z,{open:p.length>0,orders:p,handleClose:function(){j([])},portfolioName:c.currentPortfolio})]})}var R=t(6934),D=t(6314),O=t(7267),F=(0,R.ZP)("progress")((function(){return"background: blue,"})),I=[{field:"buyOrSell",headerName:"\u65b9\u5411",width:80},{field:"securityCode",headerName:"\u8bc1\u5238\u4ee3\u7801",width:120},{field:"securityName",headerName:"\u8bc1\u5238\u540d\u79f0",width:100},{field:"ratio",headerName:"\u5b8c\u6210\u7387",width:220,type:"number",renderCell:function(e){return(0,x.jsxs)(i.ZP,{container:!0,spacing:1,children:[(0,x.jsx)(i.ZP,{item:!0,xs:10,children:(0,x.jsx)(F,{value:String(e.value),max:"100"})}),(0,x.jsx)(i.ZP,{item:!0,xs:2,children:(0,x.jsx)(v.Z,{children:e.value+"%"})})]})}}];function L(e){return(0,x.jsxs)(D.Z,{direction:"row",sx:{p:1},spacing:1,children:[(0,x.jsx)(O.Z,{sx:{color:"connected"===e.status?"#4caf50":"#d9182e"}}),(0,x.jsx)(v.Z,{children:e.status})]})}function M(e){var r=e.orders,t=a.useState("connected"),o=(0,n.Z)(t,2),c=o[0];o[1];return(0,x.jsx)(i.ZP,{container:!0,spacing:2,sx:{p:2},children:(0,x.jsx)(i.ZP,{item:!0,xs:12,children:(0,x.jsx)(s._,{columns:I,rows:r||[],sx:{maxHeight:600},slots:{footer:L},slotProps:{footer:{status:c}}})})})}var A={currentPortfolio:null};function K(){var e=(0,a.useReducer)(h,A),r=(0,n.Z)(e,2),t=r[0],s=r[1],o=(0,c.a)({queryKey:["listOrders",t.currentPortfolio],queryFn:function(){return fetch(u._+"position/order?currentPortfolio="+t.currentPortfolio).then((function(e){return e.json()})).then((function(e){for(var r=0;r<e.length;r++)e[r].id=r+1;return e}))},refetchInterval:3e4}),l=o.isLoading,f=o.isError,p=o.data;return l?(0,x.jsx)("div",{children:"Loading..."}):f?(0,x.jsx)("div",{children:"There is error in querying data"}):(0,x.jsx)(d.Provider,{value:{state:t,dispatch:s},children:(0,x.jsxs)(i.ZP,{container:!0,spacing:2,children:[(0,x.jsx)(i.ZP,{item:!0,xs:6,children:(0,x.jsx)(j,{})}),0===p.length&&(0,x.jsx)(i.ZP,{item:!0,xs:6,children:(0,x.jsx)(q,{})}),p.length>0&&(0,x.jsx)(i.ZP,{item:!0,xs:6,children:(0,x.jsx)(M,{orders:p})})]})})}}}]);
//# sourceMappingURL=613.9c0bb394.chunk.js.map